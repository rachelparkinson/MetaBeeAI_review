# Notebooks

This folder contains three Jupyter notebooks that demonstrate how to merge multiple ASReview outputs into a single dataset and then perform analyses on the merged data. Below is a brief overview of each notebook and its purpose.

---

## 1. **01_merge_datasets.ipynb**

**Purpose**  
- Merges an `input_dataset.csv` with multiple CSV output files generated by ASReview (found in `../data/asreview_output`).
- Identifies and resolves any duplicate rows based on the `title` column.
- Generates two final CSV files:
  1. **`cleaned_merged_dataset.csv`** – The main dataset containing merged and deduplicated information.
  2. **`not_included_papers.csv`** – A list of papers that aren’t included in any domain.

**Key Steps**  
1. **Load Input Data**  
   - Reads `input_dataset.csv` from the `../data/` folder.
   - Displays the first few rows for a quick look.

2. **Merge ASReview Output Files**  
   - Iterates through subfolders in `../data/asreview_output`.
   - Reads each CSV file (e.g., `molec_CB.csv`, `indiv_SF.csv`, etc.).
   - Checks for `title` and `included` columns, then merges them into `input_df`.

3. **Save Merged Output**  
   - Creates `merged_dataset.csv` in the `../output/` folder.
   - Displays the head of the merged DataFrame.

4. **Handle Duplicate Rows**  
   - Detects duplicates based on the `title` column and consolidates them using a group-by.
   - Saves the cleaned result as `cleaned_merged_dataset.csv`.

**Output Files**  
- `../output/merged_dataset.csv`
- `../output/cleaned_merged_dataset.csv`
- `../output/not_included_papers.csv`

---

## 2. **02_review_output.ipynb**

**Purpose**  
- Performs analyses on the cleaned dataset (`cleaned_merged_dataset.csv`).
- Investigates domain coverage, reviewer agreement, and cross-domain overlaps.

**Key Steps**  
1. **Load Cleaned Dataset**  
   - Reads `cleaned_merged_dataset.csv` from `../output/`.

2. **Count Included Papers per Domain**  
   - Identifies columns for each domain (e.g., `molec_`, `subin_`, etc.).
   - Counts how many papers were marked as included (`1`) in each domain.
   - Produces a bar chart showing the counts.

3. **Reviewer Agreement**  
   - For each domain, calculates pairwise agreement between reviewers (e.g., `molec_A vs molec_B`).
   - Saves results to `pairwise_reviewer_agreement_with_proportion.csv`.
   - Computes the average proportion of agreement across all domains.

4. **Cross-Domain Relevance**  
   - Determines how often a paper is relevant to multiple domains.
   - Plots the distribution of papers across 1, 2, or more domains.

5. **Co-Occurrence Matrix**  
   - Creates a co-occurrence matrix for papers relevant in two or more domains.
   - Visualizes domain overlaps with a heatmap.

**Output Files**  
- `pairwise_reviewer_agreement_with_proportion.csv` – Contains pairwise reviewer agreement data.

---

## 3. **03_remove_unassigned.ipynb**

**Purpose**  
- Identifies papers not assigned to any domain (i.e., not included by any reviewer).
- Removes these unassigned (or irrelevant) papers from the final dataset.
- Optionally merges in a set of “relevant but unassigned” papers from an external file.
- Checks for missing DOIs in the final compiled dataset.

**Key Steps**  
1. **Create File with Papers Not Assigned to Any Domain**  
   - Loads `cleaned_merged_dataset.csv`.
   - Finds rows where all domain columns are either `NaN` or `0`.
   - Saves these papers to `not_included_papers.csv`.

2. **Create a Dataset of Assigned Documents**  
   - Identifies papers that have at least one domain value of `1` (or non-null).
   - Saves these to `included_papers.csv`.

3. **Merge External Relevant Unassigned Papers**  
   - Loads `relevant_unassigned_papers.csv` from `../data/`.
   - Concatenates it with `included_papers.csv`.
   - Removes duplicates (via the `title` column).
   - Saves the combined result to `final_dataset.csv`.

4. **Check for Missing DOIs**  
   - Loads the newly created `final_dataset.csv`.
   - Extracts rows with null DOIs into `missing_doi.csv`.
   - Prints the count of papers missing DOIs.

**Output Files**  
- `../output/not_included_papers.csv`  
- `../output/included_papers.csv`  
- `../output/final_dataset.csv`  
- `../output/missing_doi.csv`

---

## Usage Notes

1. **Recommended Order**  
   - Run `01_merge_datasets.ipynb` first to produce the cleaned dataset files.
   - Run `02_review_output.ipynb` to generate summary statistics, plots, and reviewer agreement metrics.
   - Finally, run `03_remove_unassigned.ipynb` to remove unassigned papers, merge external relevant unassigned data, and generate the final dataset.  

2. **Dependencies**  
   - `pandas`
   - `matplotlib`
   - `seaborn` (used in `02_review_output.ipynb`)
   - Make sure to have these installed in your environment.

3. **Data Paths**  
   - The notebooks expect data in `../data/` and output in `../output/`.
   - Adjust file paths as needed if your directory structure differs.

---

**End of README**  